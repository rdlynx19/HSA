<mujoco model="spring_tendon_variant">
  <option timestep="0.001" solver="Newton" iterations="50"/>
  <size njmax="500" nconmax="100"/>

  <asset>
    <texture name="grid" type="2d" builtin="checker" width="300" height="300"
             rgb1="0.8 0.8 0.8" rgb2="0.5 0.5 0.5" mark="edge" markrgb="0.2 0.2 0.2"/>
    <material name="gridmat" texture="grid" texrepeat="5 5" reflectance="0.1"/>
  </asset>

  <default>
    <!-- Default class for actuator sliders -->
    <joint type="slide" range="-0.2 0.2" damping="1" armature="0.01"/>
    <general ctrlrange="-1 1" biastype="affine" gainprm="10 0 0" biasprm="0 0 -10"/>
  </default>

  <worldbody>
    <geom name="floor" type="plane" size="5 5 0.1" material="gridmat" friction="2 0.2 0.01"/>

    <!-- Block A -->
    <body name="block_a" pos="-0.2 0 0.22">
      <freejoint/>
      <geom type="box" size="0.05 0.1 0.1" density="500" friction="2 0.2 0.01" rgba="0.2 0.6 0.9 1"/>

      <site name="site2b" pos="0.05 -0.07 0.07"/>
      <site name="site4b" pos="0.05 0.07 -0.07"/>

      <!-- Spring 1 A -->
      <body name="spring_1a" pos="0.05 0.07 0.07">
        <joint name="spring1a_hinge" type="hinge" axis="1 0 0" damping="1.0" limited="true" range="-45 45"/>
        <geom type="capsule" fromto="0 0 0 0.25 0 0" size="0.01" density="100"/>
        <site name="siteM1a" pos="0.25 0.0 0.0"/>
        
        <!-- Linear actuator to control siteM1a position -->
        <body name="slider1_body" pos="0.25 0 0">
          <joint name="slider1" axis="1 0 0"/>
          <geom name="slider1_geom" type="box" size="0.01 0.01 0.01" rgba="0 0.8 0 0.5"/>
          <site name="slider1_site" pos="0 0 0"/>
        </body>
      </body>

      <!-- Spring 3 A -->
      <body name="spring_3a" pos="0.05 -0.07 -0.07">
        <joint name="spring3a_hinge" type="hinge" axis="1 0 0" damping="1.0" limited="true" range="-45 45"/>
        <geom type="capsule" fromto="0 0 0 0.25 0 0" size="0.01" density="100"/>
        <site name="siteM3a" pos="0.25 -0.0 -0.0"/>
        
        <!-- Linear actuator to control siteM3a position -->
        <body name="slider3_body" pos="0.25 0 0">
          <joint name="slider3" axis="1 0 0"/>
          <geom name="slider3_geom" type="box" size="0.01 0.01 0.01" rgba="0 0.8 0 0.5"/>
          <site name="slider3_site" pos="0 0 0"/>
        </body>
      </body>
    </body>

    <!-- Block B -->
    <body name="block_b" pos="0.2 0 0.22">
      <freejoint/>
      <geom type="box" size="0.05 0.1 0.1" density="500" friction="2 0.2 0.01" rgba="0.9 0.4 0.2 1"/>

      <site name="site1b" pos="-0.05 0.07 0.07"/>
      <site name="site3b" pos="-0.05 -0.07 -0.07"/>

      <!-- Spring 2 A -->
      <body name="spring_2a" pos="-0.05 -0.07 0.07">
        <joint name="spring2a_hinge" type="hinge" axis="1 0 0" damping="1.0" limited="true" range="-45 45"/>
        <geom type="capsule" fromto="0 0 0 -0.25 0 0" size="0.01" density="100"/>
        <site name="siteM2a" pos="-0.25 -0.0 0.0"/>
        
        <!-- Linear actuator to control siteM2a position -->
        <body name="slider2_body" pos="-0.25 0 0">
          <joint name="slider2" axis="1 0 0"/>
          <geom name="slider2_geom" type="box" size="0.01 0.01 0.01" rgba="0 0.8 0 0.5"/>
          <site name="slider2_site" pos="0 0 0"/>
        </body>
      </body>

      <!-- Spring 4 A -->
      <body name="spring_4a" pos="-0.05 0.07 -0.07">
        <joint name="spring4a_hinge" type="hinge" axis="1 0 0" damping="1.0" limited="true" range="-45 45"/>
        <geom type="capsule" fromto="0 0 0 -0.25 0 0" size="0.01" density="100"/>
        <site name="siteM4a" pos="-0.25 0.0 -0.0"/>
        
        <!-- Linear actuator to control siteM4a position -->
        <body name="slider4_body" pos="-0.25 0 0">
          <joint name="slider4" axis="1 0 0"/>
          <geom name="slider4_geom" type="box" size="0.01 0.01 0.01" rgba="0 0.8 0 0.5"/>
          <site name="slider4_site" pos="0 0 0"/>
        </body>
      </body>
    </body>
  </worldbody>

  <actuator>
    <!-- Original rotary actuators -->
    <motor name="spring1a_motor" joint="spring1a_hinge" gear="0.05" ctrlrange="-5 5"/>
    <motor name="spring2a_motor" joint="spring2a_hinge" gear="0.05" ctrlrange="-5 5"/>
    <motor name="spring3a_motor" joint="spring3a_hinge" gear="0.05" ctrlrange="-5 5"/>
    <motor name="spring4a_motor" joint="spring4a_hinge" gear="0.05" ctrlrange="-5 5"/>
    
    <!-- Linear actuators to adjust tendon lengths -->
    <position name="tendon1_actuator" joint="slider1" kp="10" ctrlrange="-0.2 0.2"/>
    <position name="tendon2_actuator" joint="slider2" kp="10" ctrlrange="-0.2 0.2"/>
    <position name="tendon3_actuator" joint="slider3" kp="10" ctrlrange="-0.2 0.2"/>
    <position name="tendon4_actuator" joint="slider4" kp="10" ctrlrange="-0.2 0.2"/>
    
    <!-- Tension feedback controllers for each tendon -->
    <general name="tension1_control" joint="slider1" dyntype="filter" dynprm="0.1" gaintype="user" gainprm="5 0 0" biastype="user" biasprm="0 0 0"/>
    <general name="tension2_control" joint="slider2" dyntype="filter" dynprm="0.1" gaintype="user" gainprm="5 0 0" biastype="user" biasprm="0 0 0"/>
    <general name="tension3_control" joint="slider3" dyntype="filter" dynprm="0.1" gaintype="user" gainprm="5 0 0" biastype="user" biasprm="0 0 0"/>
    <general name="tension4_control" joint="slider4" dyntype="filter" dynprm="0.1" gaintype="user" gainprm="5 0 0" biastype="user" biasprm="0 0 0"/>
  </actuator>

  <tendon>
    <spatial name="inter1" width="0.01" rgba="0 1 0 1" stiffness="10" damping="5" springlength="0.4" range="0.2 0.6">
        <site site="slider1_site"/>
        <site site="site1b"/>
    </spatial>
    <spatial name="inter2" width="0.01" rgba="0 1 0 1" stiffness="10" damping="5" springlength="0.4" range="0.2 0.6">
        <site site="slider2_site"/>
        <site site="site2b"/>
    </spatial>
    <spatial name="inter3" width="0.01" rgba="0 1 0 1" stiffness="10" damping="5" springlength="0.4" range="0.2 0.6">
        <site site="slider3_site"/>
        <site site="site3b"/>
    </spatial>
    <spatial name="inter4" width="0.01" rgba="0 1 0 1" stiffness="10" damping="5" springlength="0.4" range="0.2 0.6">
        <site site="slider4_site"/>
        <site site="site4b"/>
    </spatial>
  </tendon>

  <!-- Sensors to monitor tendon tension and length -->
  <sensor>
    <tendonpos name="tendon1_pos" tendon="inter1"/>
    <tendonpos name="tendon2_pos" tendon="inter2"/>
    <tendonpos name="tendon3_pos" tendon="inter3"/>
    <tendonpos name="tendon4_pos" tendon="inter4"/>
    
    <tendonvel name="tendon1_vel" tendon="inter1"/>
    <tendonvel name="tendon2_vel" tendon="inter2"/>
    <tendonvel name="tendon3_vel" tendon="inter3"/>
    <tendonvel name="tendon4_vel" tendon="inter4"/>
    
  
  </sensor>
  
  <!-- Define keyframes for resetting tendons to natural length -->
  <keyframe>
    <!-- Keyframe to reset all tendons to natural lengths -->
    <key name="reset_tendons" qpos="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0" time="0.5"/>
  </keyframe>
</mujoco>